
# =======================================================
# KONFIGURASI NGINX FINAL - ANTI 403 & ANTI MIME-TYPE
# =======================================================

# 1. Pastikan folder RW memiliki izin masuk:
sudo chmod 755 /home/clusterkobapwk
sudo chmod 755 /home/clusterkobapwk/warung-app
sudo chmod 755 /home/clusterkobapwk/warung-app/sim-rw
sudo chmod 644 /home/clusterkobapwk/warung-app/sim-rw/*

# 2. Edit Config: sudo nano /etc/nginx/sites-available/default
# GANTI ISINYA DENGAN INI:

server {
    listen 80;
    server_name _;

    root /home/clusterkobapwk/warung-app/sim-rw;
    index index.html;

    # DEFINISI MIME TYPE MANUAL (SANGAT PENTING DI VM)
    include /etc/nginx/mime.types;
    types {
        application/javascript tsx ts;
        text/css css;
        image/svg+xml svg;
    }

    location / {
        # Hanya lempar ke index.html jika file fisik TIDAK ADA.
        # Jika file .tsx ada, Nginx akan mengirimkannya dengan MIME application/javascript.
        try_files $uri $uri/ /index.html;
    }

    # PROXY API KE PORT 5000
    location /api/ {
        proxy_pass http://localhost:5000/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}

# 3. Restart Nginx
# sudo nginx -t
# sudo systemctl restart nginx
